<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åäºŒç”Ÿè‚–æ‹”æ¯›è¿åŠ¨ä¼š</title>
    <style>
        /* --- æ¸¸æˆç¾åŒ–æ ·å¼ --- */
        body {
            font-family: "Microsoft YaHei", "Heiti SC", sans-serif;
            background-color: #dcedc8; /* è‰åœ°ç»¿ */
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            user-select: none;
            overflow: hidden;
        }

        h1 { color: #33691e; margin: 10px; font-size: 24px; }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        #status-bar {
            background: white;
            padding: 10px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            border: 4px solid #33691e;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        #current-player-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            border: 2px solid rgba(0,0,0,0.2);
        }

        /* æ¸¸æˆä¸»ç›˜é¢ */
        #game-board {
            position: relative;
            width: 600px;
            height: 600px;
            background-color: #a1887f; /* åœŸå£¤è‰² */
            border-radius: 50%;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
            border: 15px solid #5d4037;
        }

        /* ä¸­é—´æ± å¡˜ï¼ˆæ”¾å¡ç‰Œçš„åœ°æ–¹ï¼‰ */
        #center-pond {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 360px;
            height: 360px;
            background-color: #81c784;
            border-radius: 50%;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            padding: 40px;
            gap: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        /* å¤–åœˆè·‘é“æ ¼å­ */
        .tile {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            border: 3px solid #fff;
            z-index: 1;
        }

        /* ç©å®¶æ£‹å­ */
        .pawn {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            z-index: 100; /* ä¿è¯åœ¨æœ€ä¸Šå±‚ */
            box-shadow: 0 0 10px rgba(0,0,0,0.8);
            border: 4px solid white;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* å¼¹è·³åŠ¨ç”» */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* è®°å¿†å¡ç‰Œ */
        .card {
            background-color: #5d4037; /* å¡èƒŒé¢œè‰² */
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .card.flipped {
            transform: rotateY(180deg);
            background-color: #fff;
            cursor: default;
        }

        /* å¡ç‰Œå†…å®¹ */
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .card-back {
            background: repeating-linear-gradient(
                45deg,
                #5d4037,
                #5d4037 10px,
                #4e342e 10px,
                #4e342e 20px
            );
        }

        .card-front {
            background-color: white;
            transform: rotateY(180deg);
            color: #333;
            border: 2px solid #5d4037;
        }

        .hanzi { font-size: 28px; font-weight: bold; line-height: 1.2; }
        .pinyin { font-size: 14px; color: #e65100; font-weight: bold; }

        /* æç¤ºæ¡† */
        #message-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 30px;
            display: none;
            z-index: 999;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="status-bar">
        <div>å½“å‰å›åˆ:</div>
        <div id="current-player-indicator"></div>
        <div id="player-text">ç©å®¶</div>
    </div>

    <div id="game-board">
        <div id="center-pond">
            </div>
    </div>

    <div id="message-overlay">å¤ªæ£’äº†ï¼ç»§ç»­ï¼</div>

    <script>
        // --- 1. æ¸¸æˆæ•°æ®é…ç½® ---
        
        // åäºŒç”Ÿè‚–æ•°æ® (å›¾æ¡ˆ + æ±‰å­— + æ‹¼éŸ³)
        const zodiacs = [
            { id: 1,  icon: 'ğŸ­', hanzi: 'é¼ ', pinyin: 'shÇ”' },
            { id: 2,  icon: 'ğŸ®', hanzi: 'ç‰›', pinyin: 'niÃº' },
            { id: 3,  icon: 'ğŸ¯', hanzi: 'è™', pinyin: 'hÇ”' },
            { id: 4,  icon: 'ğŸ°', hanzi: 'å…”', pinyin: 'tÃ¹' },
            { id: 5,  icon: 'ğŸ²', hanzi: 'é¾™', pinyin: 'lÃ³ng' },
            { id: 6,  icon: 'ğŸ', hanzi: 'è›‡', pinyin: 'shÃ©' },
            { id: 7,  icon: 'ğŸ´', hanzi: 'é©¬', pinyin: 'mÇ' },
            { id: 8,  icon: 'ğŸ‘', hanzi: 'ç¾Š', pinyin: 'yÃ¡ng' },
            { id: 9,  icon: 'ğŸµ', hanzi: 'çŒ´', pinyin: 'hÃ³u' },
            { id: 10, icon: 'ğŸ”', hanzi: 'é¸¡', pinyin: 'jÄ«' },
            { id: 11, icon: 'ğŸ¶', hanzi: 'ç‹—', pinyin: 'gÇ’u' },
            { id: 12, icon: 'ğŸ·', hanzi: 'çŒª', pinyin: 'zhÅ«' }
        ];

        // è·‘é“ï¼š12ç”Ÿè‚–å¾ªç¯2æ¬¡ = 24æ ¼
        const trackList = [...zodiacs, ...zodiacs]; 
        
        // 4åå­¦ç”Ÿç©å®¶
        const players = [
            { id: 0, name: "å°çº¢", color: "#f44336", pos: 0 },  // çº¢è‰²
            { id: 1, name: "å°è“", color: "#2196f3", pos: 6 },  // è“è‰²
            { id: 2, name: "å°é»„", color: "#ffeb3b", pos: 12 }, // é»„è‰²
            { id: 3, name: "å°ç»¿", color: "#4caf50", pos: 18 }  // ç»¿è‰²
        ];

        let turnIndex = 0; // å½“å‰è½®åˆ°è°
        let isLocked = false; // é˜²æ­¢ç‹‚ç‚¹

        // --- 2. ç•Œé¢åˆå§‹åŒ–å¼•æ“ ---

        const board = document.getElementById('game-board');
        const pond = document.getElementById('center-pond');
        const msgOverlay = document.getElementById('message-overlay');

        // è®¡ç®—åœ†å‘¨ä½ç½®çš„è¾…åŠ©å‡½æ•°
        function getPosition(index, total, radius) {
            const angle = (index / total) * 2 * Math.PI - (Math.PI / 2); // -90åº¦è®©ç¬¬ä¸€ä¸ªåœ¨æ­£ä¸Šæ–¹
            const x = 300 + radius * Math.cos(angle);
            const y = 300 + radius * Math.sin(angle);
            return { x, y };
        }

        // A. ç”Ÿæˆè·‘é“ (åŠå¾„265)
        trackList.forEach((item, idx) => {
            const tile = document.createElement('div');
            tile.className = 'tile';
            tile.innerText = item.icon;
            const pos = getPosition(idx, 24, 265);
            tile.style.left = (pos.x - 25) + 'px'; // -25æ˜¯åŠå¾„ä¿®æ­£
            tile.style.top = (pos.y - 25) + 'px';
            board.appendChild(tile);
        });

        // B. ç”Ÿæˆç©å®¶
        players.forEach(p => {
            const pawn = document.createElement('div');
            pawn.className = 'pawn';
            pawn.id = `p-${p.id}`;
            pawn.style.backgroundColor = p.color;
            pawn.innerText = (p.id + 1); // æ˜¾ç¤ºæ•°å­—ç¼–å·
            if(p.id === 2) pawn.style.color = 'black'; // é»„è‰²æ£‹å­é…é»‘å­—æ¸…æ¥šç‚¹
            board.appendChild(pawn);
            renderPlayerPos(p);
        });

        function renderPlayerPos(p) {
            const idx = p.pos % 24;
            // æ£‹å­ç¨å¾®é å†…åœˆä¸€ç‚¹ç‚¹(åŠå¾„265 -> 220)ï¼Œé¿å…é®æŒ¡å›¾æ¡ˆ
            const pos = getPosition(idx, 24, 265); 
            const el = document.getElementById(`p-${p.id}`);
            el.style.left = (pos.x - 20) + 'px';
            el.style.top = (pos.y - 20) + 'px';
        }

        // C. ç”Ÿæˆä¸­é—´å¡ç‰Œ (æ´—ç‰Œ)
        let deck = [...zodiacs];
        deck.sort(() => Math.random() - 0.5); // éšæœºæ‰“ä¹±

        deck.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-back"></div>
                <div class="card-front">
                    <div class="hanzi">${item.hanzi}</div>
                    <div class="pinyin">${item.pinyin}</div>
                </div>
            `;
            card.onclick = () => onCardClick(card, item);
            pond.appendChild(card);
        });

        updateStatusBar();

        // --- 3. æ ¸å¿ƒæ¸¸æˆé€»è¾‘ ---

        function onCardClick(cardEl, cardData) {
            if (isLocked) return;
            if (cardEl.classList.contains('flipped')) return;

            isLocked = true;
            cardEl.classList.add('flipped'); // ç¿»å¼€åŠ¨ä½œ

            const currPlayer = players[turnIndex];
            
            // ç›®æ ‡ï¼šå½“å‰ç©å®¶è„šä¸‹é‚£ä¸€æ ¼çš„â€œä¸‹ä¸€æ ¼â€æ˜¯ä»€ä¹ˆåŠ¨ç‰©ï¼Ÿ
            const nextStepIndex = (currPlayer.pos + 1) % 24;
            const targetZodiacId = trackList[nextStepIndex].id;

            // å»¶æ—¶åˆ¤æ–­ï¼Œç»™å­¦ç”Ÿé˜…è¯»æ—¶é—´
            setTimeout(() => {
                if (cardData.id === targetZodiacId) {
                    // >> åŒ¹é…æˆåŠŸï¼ <<
                    showMsg("åŒ¹é…æˆåŠŸï¼ğŸƒâ€â™‚ï¸");
                    
                    // ç§»åŠ¨ç©å®¶
                    currPlayer.pos += 1;
                    renderPlayerPos(currPlayer);
                    
                    // æ‹”æ¯›è§„åˆ™ç®€åŒ–ï¼šå¦‚æœè¿™ä¸€æ ¼æœ‰äººï¼Œå°±è·³è¿‡å»ï¼ˆç®€å•çš„è¶…è½¦é€»è¾‘ï¼‰
                    checkOvertake(currPlayer);

                    // ç›–å›ç‰Œï¼ˆè¿™æ˜¯è®°å¿†æ¸¸æˆï¼Œä½ç½®ä¸å˜ï¼‰
                    setTimeout(() => {
                        cardEl.classList.remove('flipped');
                        isLocked = false;
                        // å¥–åŠ±ï¼šä¸ç”¨åˆ‡æ¢ç©å®¶ï¼Œç»§ç»­ç©ï¼
                        updateStatusBar();
                    }, 1000);

                } else {
                    // >> åŒ¹é…å¤±è´¥ <<
                    showMsg("å¯æƒœï¼Œæ²¡å¯¹ä¸Š...");
                    
                    setTimeout(() => {
                        cardEl.classList.remove('flipped');
                        // åˆ‡æ¢ä¸‹ä¸€ä¸ª
                        turnIndex = (turnIndex + 1) % 4;
                        updateStatusBar();
                        isLocked = false;
                    }, 1500);
                }
            }, 1000); // ç¿»å¼€çœ‹1ç§’
        }

        function checkOvertake(mover) {
            // ç®€å•çš„é˜²é‡å é€»è¾‘ï¼šå¦‚æœç§»åŠ¨åçš„ä½ç½®æœ‰åˆ«äººï¼Œå†å¾€å‰èµ°ä¸€æ­¥
            // çœŸå®æ‹”æ¯›è§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œä¸ºäº†ç½‘é¡µç®€å•ä½“éªŒï¼Œæ”¹ä¸ºâ€œè·³é©¬â€
            let isOccupied = true;
            while(isOccupied) {
                isOccupied = false;
                const myIdx = mover.pos % 24;
                players.forEach(other => {
                    if (other.id !== mover.id) {
                        const otherIdx = other.pos % 24;
                        if (myIdx === otherIdx) {
                            // æ’è½¦äº†ï¼Œè·³è¿‡å»
                            mover.pos += 1;
                            renderPlayerPos(mover);
                            isOccupied = true; // é‡æ–°æ£€æŸ¥æ–°ä½ç½®
                            showMsg("è·³è¿‡å¯¹æ‰‹ï¼âš¡");
                        }
                    }
                });
            }
        }

        function showMsg(text) {
            msgOverlay.innerText = text;
            msgOverlay.style.display = 'block';
            setTimeout(() => {
                msgOverlay.style.display = 'none';
            }, 1000);
        }

        function updateStatusBar() {
            const p = players[turnIndex];
            const indicator = document.getElementById('current-player-indicator');
            const txt = document.getElementById('player-text');
            
            indicator.style.backgroundColor = p.color;
            txt.innerText = `${p.name} çš„å›åˆ (æ‰¾: ${getNextAnimalName(p)})`;
            txt.style.color = p.color === '#ffeb3b' ? '#fbc02d' : p.color; // é»„è‰²æ–‡å­—åŠ æ·±ä¸€ç‚¹ä¾¿äºé˜…è¯»
        }

        function getNextAnimalName(player) {
            const nextIdx = (player.pos + 1) % 24;
            return trackList[nextIdx].icon;
        }

    </script>
</body>
</html>